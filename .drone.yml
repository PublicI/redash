
pipeline:
  build:
    image: plugins/docker
    secrets: [ docker_username, docker_password ]
    repo: publicintegrity/redash

  helm_deploy:
    image: peloton/drone-helm
    chart: ./charts/redash
    release: archive
    values: image.repository=publicintegrity/redash,image.tag=latest
    prefix:
    namespace: archive
    secrets: [ api_server, kubernetes_token ]
    skip_tls_verify: true

  slack:
    image: plugins/slack
    secrets: [ slack_webhook ]
    when:
      status: [ success, failure ]
